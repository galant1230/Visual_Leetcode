
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>235. BST æœ€è¿‘å…±åŒç¥–å…ˆå‹•ç•«</title>
  <style>
    body { font-family: sans-serif; background: #f8f9fa; padding: 2rem; }
    .tree-container { text-align: center; margin-top: 2rem; }
    .level { display: flex; justify-content: center; margin: 6px 0; }
    .node {
      width: 40px; height: 40px;
      border: 2px solid #3498db;
      border-radius: 50%;
      background: white;
      color: #3498db;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold;
      margin: 4px;
      cursor: pointer;
    }
    .highlight { background: #ffeaa7; color: #000; }
    .pnode { background: #74b9ff !important; color: white; }
    .qnode { background: #fab1a0 !important; color: white; }
    .lcanode { background: #2ecc71 !important; color: white; }
    .info { text-align: center; margin-top: 1rem; font-size: 16px; }
    input, button { font-size: 1rem; margin: 0.5rem; padding: 0.3rem 0.6rem; }
    button { background: #2980b9; color: white; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

<h1>ğŸŒ³ 235. æœ€è¿‘å…±åŒç¥–å…ˆï¼ˆLCAï¼‰ - BST å‹•ç•«</h1>

<div style="text-align:center;">
  <label>Level Order Treeï¼š</label>
  <input id="inputTree" value="[6,2,8,0,4,7,9,null,null,3,5]" style="width:360px;" />
  <br/>
  <button onclick="start()">åˆå§‹åŒ–æ¨¹</button>
  <button onclick="findLCA()">å°‹æ‰¾ LCA</button>
</div>


<div class="info" style="margin-top:20px; text-align:left; background:#ecf0f1; padding:1rem; border-left:6px solid #3498db;">
  <h3>ğŸ“ ä½¿ç”¨èªªæ˜ï¼š</h3>
  <ul>
    <li>å…ˆé»ç¬¬ä¸€å€‹ç¯€é»ï¼Œæœƒæ¨™æˆ <span style="color:#0984e3;"><b>è—è‰²</b>ï¼ˆpï¼‰</span></li>
    <li>å†é»ç¬¬äºŒå€‹ç¯€é»ï¼Œæœƒæ¨™æˆ <span style="color:#d63031;"><b>ç´…è‰²</b>ï¼ˆqï¼‰</span></li>
    <li>æŒ‰ä¸‹ <b>ã€Œå°‹æ‰¾ LCAã€</b> âœ é–‹å§‹æ ¹æ“š BST è¦å‰‡æ¯”å°ä¸¦æ‰¾å‡ºæœ€è¿‘å…±åŒç¥–å…ˆ</li>
    <li>çµæœæœƒä»¥ <span style="color:#27ae60;"><b>ç¶ è‰²</b>ç¯€é»</span> é¡¯ç¤º</li>
  </ul>
</div>
<div class="tree-container" id="tree"></div>

<div class="info" id="info">é»å…©å€‹ç¯€é»ä½œç‚º p, q</div>

<script>
let id = 0, selected = [], root = null;

class TreeNode {
  constructor(val) {
    this.val = val;
    this.left = null;
    this.right = null;
    this.id = id++;
  }
}

function buildTree(arr) {
  if (!arr.length || arr[0] === null) return null;
  let root = new TreeNode(arr[0]);
  let queue = [root];
  let i = 1;
  while (queue.length && i < arr.length) {
    let node = queue.shift();
    if (arr[i] !== null) {
      node.left = new TreeNode(arr[i]);
      queue.push(node.left);
    }
    i++;
    if (i < arr.length && arr[i] !== null) {
      node.right = new TreeNode(arr[i]);
      queue.push(node.right);
    }
    i++;
  }
  return root;
}

function renderTree(root) {
  const treeEl = document.getElementById("tree");
  treeEl.innerHTML = "";
  const levels = [];
  function dfs(node, depth, pos) {
    if (!node) return;
    if (!levels[depth]) levels[depth] = [];
    levels[depth][pos] = node;
    dfs(node.left, depth + 1, pos * 2);
    dfs(node.right, depth + 1, pos * 2 + 1);
  }
  dfs(root, 0, 0);
  levels.forEach(row => {
    const r = document.createElement("div");
    r.className = "level";
    row.forEach(n => {
      const d = document.createElement("div");
      d.className = "node";
      d.id = "n" + n.id;
      d.innerText = n.val;
      d.onclick = () => selectNode(n);
      r.appendChild(d);
    });
    treeEl.appendChild(r);
  });
}

function selectNode(node) {
  const el = document.getElementById("n" + node.id);
  if (selected.length === 2) {
    selected = [];
    document.querySelectorAll(".node").forEach(n => n.classList.remove("pnode", "qnode", "lcanode"));
  }
  selected.push(node);
  if (selected.length === 1) el.classList.add("pnode");
  if (selected.length === 2) el.classList.add("qnode");
  document.getElementById("info").innerText = selected.length === 2 ? "é»ã€å°‹æ‰¾ LCAã€å§ï¼" : "å·²é¸ä¸€å€‹ç¯€é»";
}

function findLCA() {
  if (selected.length < 2) return;
  const p = selected[0], q = selected[1];
  function dfs(node) {
    if (!node) return null;
    const nid = "n" + node.id;
    document.getElementById(nid).classList.add("highlight");
    if (p.val < node.val && q.val < node.val) return dfs(node.left);
    if (p.val > node.val && q.val > node.val) return dfs(node.right);
    return node;
  }
  
setTimeout(() => {
  const result = dfs(root);
  if (result) {
    document.getElementById("n" + result.id).classList.add("lcanode");
    document.getElementById("info").innerHTML = `âœ… LCA æ˜¯ <b>${result.val}</b>`;
  }
}, 100);

  if (lca) {
    document.getElementById("n" + lca.id).classList.add("lcanode");
    document.getElementById("info").innerHTML = `âœ… LCA æ˜¯ <b>${lca.val}</b>`;
  }
}

function start() {
  const arr = JSON.parse(document.getElementById("inputTree").value);
  id = 0; selected = [];
  document.getElementById("info").innerText = "é»å…©å€‹ç¯€é»ä½œç‚º p, q";
  root = buildTree(arr);
  renderTree(root);
}
</script>


<h2>ğŸ”§ Python è§£æ³•</h2>
<pre><code class="language-python">class Solution:
    def lowestCommonAncestor(self, root: 'TreeNode', p: 'TreeNode', q: 'TreeNode') -> 'TreeNode':
        if not root:
            return None

        # è‹¥ p å’Œ q éƒ½æ¯” root å°ï¼Œå¾€å·¦å­æ¨¹æ‰¾
        if p.val < root.val and q.val < root.val:
            return self.lowestCommonAncestor(root.left, p, q)

        # è‹¥ p å’Œ q éƒ½æ¯” root å¤§ï¼Œå¾€å³å­æ¨¹æ‰¾
        if p.val > root.val and q.val > root.val:
            return self.lowestCommonAncestor(root.right, p, q)

        # å…¶ä»–æƒ…æ³ï¼Œroot å°±æ˜¯æœ€è¿‘å…±åŒç¥–å…ˆ
        return root
</code></pre>

<h2>ğŸ“˜ è§£æ³•èªªæ˜</h2>
<div class="box">
<ul>
  <li>åˆ©ç”¨ BST çš„æ€§è³ªï¼šå·¦ < root < å³</li>
  <li>å¦‚æœ p å’Œ q éƒ½å°æ–¼ rootï¼Œå¾€å·¦å­æ¨¹æ‰¾</li>
  <li>å¦‚æœ p å’Œ q éƒ½å¤§æ–¼ rootï¼Œå¾€å³å­æ¨¹æ‰¾</li>
  <li>å¦‚æœä¸€å€‹åœ¨å·¦ã€ä¸€å€‹åœ¨å³ï¼Œæˆ–å…¶ä¸­ä¸€å€‹ç­‰æ–¼ rootï¼Œé‚£ root å°±æ˜¯æœ€è¿‘å…±åŒç¥–å…ˆ</li>
</ul>
</div>

<h2>ğŸ’¡ Tips</h2>
<div class="tips">
<ul>
  <li>é€™é¡Œé™å®šåœ¨ BST âœ å¯åˆ©ç”¨é †åºæ€§å¿«é€Ÿæ±ºç­–è·¯å¾‘</li>
  <li>æ™®é€š Binary Tree å‰‡éœ€ postorder å›å‚³ flag æˆ–è·¯å¾‘æ¯”å°</li>
  <li>å¯ç”¨éè¿´æˆ–è¿´åœˆï¼ˆè¿´åœˆå¯çœéè¿´ç©ºé–“ï¼‰</li>
</ul>
</div>

<h2>â± æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦</h2>
<div class="box">
<ul>
  <li><strong>æ™‚é–“è¤‡é›œåº¦ï¼š</strong>O(h)</li>
  <li><strong>ç©ºé–“è¤‡é›œåº¦ï¼š</strong>O(h)</li>
</ul>
<p>h ç‚ºæ¨¹é«˜ï¼Œå¹³å‡ç‚º O(log n)ï¼Œæœ€å·®ç‚º O(n)ï¼ˆé€€åŒ–ç‚ºéˆç‹€ï¼‰</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
</body>

</html>
