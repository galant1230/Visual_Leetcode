<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>BST æœ€è¿‘å…±åŒç¥–å…ˆæ¨¡æ“¬å™¨</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      margin: 0;
      color: #333;
    }
    h2, h3 {
      color: #007acc;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    ul {
      padding-left: 1.2rem;
    }
    input, button {
      font-size: 1rem;
      margin: 0.5rem 0.3rem;
      padding: 0.4rem 0.6rem;
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .tree-container {
      text-align: center;
      margin-top: 2rem;
    }
    .level {
      display: flex;
      justify-content: center;
      margin: 6px 0;
    }
    .node {
      width: 40px; height: 40px;
      border: 2px solid #3498db;
      border-radius: 50%;
      background: white;
      color: #3498db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin: 4px;
      cursor: pointer;
    }
    .highlight { background: #ffeaa7; color: #000; }
    .pnode { background: #74b9ff !important; color: white; }
    .qnode { background: #fab1a0 !important; color: white; }
    .lcanode { background: #2ecc71 !important; color: white; }
    .info {
      margin-top: 1rem;
      padding: 1rem;
      background: #ecf0f1;
      border-left: 6px solid #3498db;
    }
    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸŒ³ 235. æœ€è¿‘å…±åŒç¥–å…ˆï¼ˆLCAï¼‰ - BST æ¨¡æ“¬å™¨</h2>

    <hr>
    <h3>ğŸ“˜ é¡Œç›®æè¿°</h3>
    <p>çµ¦å®šä¸€æ£µäºŒå…ƒæœå°‹æ¨¹ï¼ˆBSTï¼‰ä»¥åŠå…©å€‹ç¯€é» <code>p</code> å’Œ <code>q</code>ï¼Œæ‰¾å‡ºå®ƒå€‘çš„æœ€è¿‘å…±åŒç¥–å…ˆï¼ˆLowest Common Ancestor, LCAï¼‰ã€‚</p>

    <hr>
    <h3>ğŸ§  è§£æ³•èªªæ˜</h3>
    <ul>
      <li>åˆ©ç”¨ BST çš„æ€§è³ªï¼šå·¦ < root < å³</li>
      <li>p, q éƒ½æ¯” root å° âœ å‘å·¦å­æ¨¹æœå°‹</li>
      <li>p, q éƒ½æ¯” root å¤§ âœ å‘å³å­æ¨¹æœå°‹</li>
      <li>è‹¥ä¸€å€‹åœ¨å·¦ã€ä¸€å€‹åœ¨å³ï¼Œæˆ–æœ‰ä¸€å€‹ç­‰æ–¼ root âœ root å³ç‚ºæœ€è¿‘å…±åŒç¥–å…ˆ</li>
    </ul>

    <hr>
    <h3>â³ æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦</h3>
    <ul>
      <li><strong>æ™‚é–“è¤‡é›œåº¦ï¼š</strong>O(h)</li>
      <li><strong>ç©ºé–“è¤‡é›œåº¦ï¼š</strong>O(h)</li>
    </ul>
    <p>å…¶ä¸­ h ç‚ºæ¨¹é«˜ï¼Œå¹³å‡ç‚º O(log n)ï¼Œæœ€å·®ç‚º O(n)</p>

    <hr>
    <h3>â–¶ï¸ æ¨¡æ“¬å™¨</h3>
    <div>
      <label>Level Order Tree: <input id="inputTree" value="[6,2,8,0,4,7,9,null,null,3,5]" style="width:360px;" /></label><br>
      <button onclick="start()">ğŸ”ƒ åˆå§‹åŒ–æ¨¹</button>
      <button onclick="findLCA()">ğŸ“ å°‹æ‰¾ LCA</button>
    </div>
    <div class="info">
      <ul>
        <li>é»å…©å€‹ç¯€é» âœ ç¬¬ä¸€å€‹ç‚º <span style="color:#0984e3;"><b>è—è‰²</b>ï¼ˆpï¼‰</span>ï¼Œç¬¬äºŒå€‹ç‚º <span style="color:#d63031;"><b>ç´…è‰²</b>ï¼ˆqï¼‰</span></li>
        <li>æŒ‰ä¸‹ã€Œå°‹æ‰¾ LCAã€âœ é¡¯ç¤º <span style="color:#2ecc71;"><b>ç¶ è‰²ç¯€é»</b></span> ç‚ºæœ€è¿‘å…±åŒç¥–å…ˆ</li>
      </ul>
    </div>
    <div class="tree-container" id="tree"></div>
    <div class="info" id="info">é»å…©å€‹ç¯€é»ä½œç‚º p, q</div>

    <hr>
    <h3>ğŸ’» Python è§£æ³•</h3>
    <pre><code>class Solution:
    def lowestCommonAncestor(self, root: 'TreeNode', p: 'TreeNode', q: 'TreeNode') -> 'TreeNode':
        if not root:
            return None

        if p.val < root.val and q.val < root.val:
            return self.lowestCommonAncestor(root.left, p, q)

        if p.val > root.val and q.val > root.val:
            return self.lowestCommonAncestor(root.right, p, q)

        return root</code></pre>
  </div>

  <script>
    let id = 0, selected = [], root = null;
    class TreeNode {
      constructor(val) {
        this.val = val;
        this.left = null;
        this.right = null;
        this.id = id++;
      }
    }

    function buildTree(arr) {
      if (!arr.length || arr[0] === null) return null;
      let root = new TreeNode(arr[0]);
      let queue = [root];
      let i = 1;
      while (queue.length && i < arr.length) {
        let node = queue.shift();
        if (arr[i] !== null) {
          node.left = new TreeNode(arr[i]);
          queue.push(node.left);
        }
        i++;
        if (i < arr.length && arr[i] !== null) {
          node.right = new TreeNode(arr[i]);
          queue.push(node.right);
        }
        i++;
      }
      return root;
    }

    function renderTree(root) {
      const treeEl = document.getElementById("tree");
      treeEl.innerHTML = "";
      const levels = [];
      function dfs(node, depth, pos) {
        if (!node) return;
        if (!levels[depth]) levels[depth] = [];
        levels[depth][pos] = node;
        dfs(node.left, depth + 1, pos * 2);
        dfs(node.right, depth + 1, pos * 2 + 1);
      }
      dfs(root, 0, 0);
      levels.forEach(row => {
        const r = document.createElement("div");
        r.className = "level";
        row.forEach(n => {
          if (!n) return;
          const d = document.createElement("div");
          d.className = "node";
          d.id = "n" + n.id;
          d.innerText = n.val;
          d.onclick = () => selectNode(n);
          r.appendChild(d);
        });
        treeEl.appendChild(r);
      });
    }

    function selectNode(node) {
      const el = document.getElementById("n" + node.id);
      if (selected.length === 2) {
        selected = [];
        document.querySelectorAll(".node").forEach(n => n.classList.remove("pnode", "qnode", "lcanode"));
      }
      selected.push(node);
      if (selected.length === 1) el.classList.add("pnode");
      if (selected.length === 2) el.classList.add("qnode");
      document.getElementById("info").innerText = selected.length === 2 ? "é»ã€å°‹æ‰¾ LCAã€å§ï¼" : "å·²é¸ä¸€å€‹ç¯€é»";
    }

    function findLCA() {
      if (selected.length < 2) return;
      const p = selected[0], q = selected[1];
      function dfs(node) {
        if (!node) return null;
        const nid = "n" + node.id;
        document.getElementById(nid).classList.add("highlight");
        if (p.val < node.val && q.val < node.val) return dfs(node.left);
        if (p.val > node.val && q.val > node.val) return dfs(node.right);
        return node;
      }
      setTimeout(() => {
        const result = dfs(root);
        if (result) {
          document.getElementById("n" + result.id).classList.add("lcanode");
          document.getElementById("info").innerHTML = `âœ… LCA æ˜¯ <b>${result.val}</b>`;
        }
      }, 100);
    }

    function start() {
      const arr = JSON.parse(document.getElementById("inputTree").value);
      id = 0; selected = [];
      document.getElementById("info").innerText = "é»å…©å€‹ç¯€é»ä½œç‚º p, q";
      root = buildTree(arr);
      renderTree(root);
    }
  </script>
</body>
</html>