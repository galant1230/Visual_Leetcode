
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>102. 二元樹的層序遍歷｜視覺化動畫</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 2rem; }
    h1 { text-align: center; color: #007acc; }
    .tree, .queue, .code, .output, .tips { text-align: center; margin-top: 2rem; }
    .layer, .queue-items { display: flex; justify-content: center; margin: 1rem 0; flex-wrap: wrap; }
    .node, .queue-item {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid #3498db;
      background: white;
      color: #3498db;
      font-weight: bold;
      font-size: 18px;
      margin: 0 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .node.highlight { background: #f39c12; color: white; }
    .queue-item.front { background: #2ecc71; color: white; }
    .output, .tips { font-size: 18px; }
    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      max-width: 800px;
      margin: 2rem auto;
      font-size: 14px;
      line-height: 1.5;
      text-align: left;
    }
    .active-line {
      background: #444;
    }
    button {
      background: #007acc;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 1rem;
      font-size: 16px;
    }
  </style>
</head>
<body>

<h1>102. 二元樹的層序遍歷 (Level Order Traversal)</h1>

<div class="code">
  <pre>
<span id="c1">1: def levelOrder(root):</span>
<span id="c2">2: &nbsp;&nbsp;&nbsp;&nbsp;if not root: return []</span>
<span id="c3">3: &nbsp;&nbsp;&nbsp;&nbsp;res = []</span>
<span id="c4">4: &nbsp;&nbsp;&nbsp;&nbsp;queue = [root]</span>
<span id="c5">5: &nbsp;&nbsp;&nbsp;&nbsp;while queue:</span>
<span id="c6">6: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;level = []</span>
<span id="c7">7: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for _ in range(len(queue)):</span>
<span id="c8">8: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node = queue.pop(0)</span>
<span id="c9">9: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;level.append(node.val)</span>
<span id="c10">10: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if node.left: queue.append(node.left)</span>
<span id="c11">11: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if node.right: queue.append(node.right)</span>
<span id="c12">12: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.append(level)</span>
<span id="c13">13: return res</span>
  </pre>
</div>

<div class="tree" id="tree">
  <div class="layer">
    <div class="node" id="n0">1</div>
  </div>
  <div class="layer">
    <div class="node" id="n1">2</div>
    <div class="node" id="n2">3</div>
  </div>
  <div class="layer">
    <div class="node" id="n3">4</div>
    <div class="node" id="n4">5</div>
  </div>
</div>

<div class="queue">
  <h3>📥 Queue</h3>
  <div class="queue-items" id="queueBox"></div>
</div>

<div class="output">
  <div>🟢 結果：<span id="output">[]</span></div>
</div>

<div style="text-align:center;">
  <button onclick="nextStep()">下一步</button>
  <button onclick="reset()">重置</button>
</div>

<div class="tips">
  <h3>🧠 小技巧 Tips</h3>
  <ul style="list-style: none;">
    <li>✔️ 使用 Queue 資料結構來進行層序 BFS</li>
    <li>✔️ 每層用 `len(queue)` 控制層級範圍</li>
    <li>✔️ 每次從 queue 中 pop 一個節點處理，再 push 它的左右子節點</li>
  </ul>

  <h3>⏱ 時間與空間複雜度</h3>
  <p>時間複雜度：<strong>O(n)</strong>（每個節點拜訪一次）</p>
  <p>空間複雜度：<strong>O(n)</strong>（最壞情況 queue 裡同時存在 n/2 個節點）</p>
</div>

<script>
const values = [1, 2, 3, 4, 5];
let steps = [], index = 0, result = [];

function highlightLine(n) {
  for (let i = 1; i <= 13; i++) {
    document.getElementById("c" + i).classList.remove("active-line");
  }
  if (n) document.getElementById("c" + n).classList.add("active-line");
}

function bfsVisualize() {
  steps = [];
  let queue = [0];

  steps.push({ type: "code", line: 4 });

  while (queue.length > 0) {
    steps.push({ type: "code", line: 5 });

    const levelSize = queue.length;
    let level = [];
    steps.push({ type: "code", line: 6 });

    for (let i = 0; i < levelSize; i++) {
      const nodeIdx = queue.shift();
      steps.push({ type: "highlight", idx: nodeIdx, queue: [...queue], line: 8 });

      level.push(values[nodeIdx]);
      steps.push({ type: "code", line: 9 });

      const left = 2 * nodeIdx + 1;
      const right = 2 * nodeIdx + 2;

      if (left < values.length) {
        queue.push(left);
        steps.push({ type: "code", line: 10 });
      }
      if (right < values.length) {
        queue.push(right);
        steps.push({ type: "code", line: 11 });
      }

      steps.push({ type: "dequeue", idx: nodeIdx, queue: [...queue] });
    }

    steps.push({ type: "addLevel", level });
    steps.push({ type: "code", line: 12 });
  }

  steps.push({ type: "code", line: 13 });
}

function renderQueue(queue) {
  const qbox = document.getElementById("queueBox");
  qbox.innerHTML = "";
  queue.forEach((i, idx) => {
    const div = document.createElement("div");
    div.className = "queue-item" + (idx === 0 ? " front" : "");
    div.innerText = values[i];
    qbox.appendChild(div);
  });
}

function nextStep() {
  if (index >= steps.length) return;
  const step = steps[index++];

  if (step.type === "code") {
    highlightLine(step.line);
  }

  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));

  if (step.type === "highlight") {
    document.getElementById("n" + step.idx).classList.add("highlight");
    renderQueue([step.idx, ...step.queue]);
  } else if (step.type === "dequeue") {
    renderQueue(step.queue);
  } else if (step.type === "addLevel") {
    result.push(step.level);
    document.getElementById("output").innerText = JSON.stringify(result);
  }
}

function reset() {
  index = 0;
  result = [];
  document.getElementById("output").innerText = "[]";
  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));
  document.getElementById("queueBox").innerHTML = "";
  highlightLine(null);
  bfsVisualize();
}
reset();
</script>

</body>
</html>
