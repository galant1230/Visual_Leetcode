<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>124. æœ€å¤§è·¯å¾‘ç¸½å’Œå‹•ç•«æ¨¡æ“¬å™¨</title>
  <style>
    body { font-family: sans-serif; background: #f8f9fa; padding: 2rem; }
    h1 { text-align: center; color: #007acc; }
    .tree { text-align: center; margin-top: 2rem; }
    .layer { display: flex; justify-content: center; margin: 2rem 0; }
    .node {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #3498db;
      background: white;
      color: #3498db;
      font-weight: bold;
      font-size: 20px;
      margin: 0 20px;
      position: relative;
    }
    .node.highlight { background: #f39c12; color: white; }
    .value-label {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
    }
    #info { text-align: center; margin-top: 2rem; font-size: 16px; }
    #maxSumBox {
      background: #e1f5fe;
      border: 2px solid #29b6f6;
      padding: 1rem;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin-top: 2rem;
      color: #007acc;
    }
    button {
      background: #007acc;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 1rem;
      font-size: 16px;
    }
    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      max-width: 800px;
      margin: 2rem auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .active-line {
      background: #444;
    }
  </style>
</head>
<body>

<h1>124. äºŒå…ƒæ¨¹ä¸­çš„æœ€å¤§è·¯å¾‘ç¸½å’Œï½œå‹•ç•«æ¨¡æ“¬å™¨</h1>

<div style="text-align:center;">
  <label>è‡ªè¨‚æ¨¹ï¼ˆå¦‚ [1,2,3,null,null,4,5]ï¼‰ï¼š</label><br/>
  <input id="treeInput" value="[1,2,3]" style="width:300px;padding:5px;font-size:16px;margin:10px;" />
  <button onclick="loadTree()">è¼‰å…¥æ¨¹</button>
</div>

<pre id="codeBox">
<span id="c1">1: def maxPathSum(root):</span>
<span id="c2">2: &nbsp;&nbsp;&nbsp;&nbsp;maxSum = -âˆ</span>
<span id="c3">3: &nbsp;&nbsp;&nbsp;&nbsp;def dfs(node):</span>
<span id="c4">4: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not node: return 0</span>
<span id="c5">5: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left = max(dfs(node.left), 0)</span>
<span id="c6">6: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right = max(dfs(node.right), 0)</span>
<span id="c7">7: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current = node.val + left + right</span>
<span id="c8">8: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxSum = max(maxSum, current)</span>
<span id="c9">9: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return node.val + max(left, right)</span>
<span id="c10">10: return dfs(root)</span>
</pre>

<div class="tree" id="tree"></div>
<div id="maxSumBox">ğŸ”µ æœ€å¤§ç¸½å’Œï¼š<span id="maxSum">-âˆ</span></div>
<div id="info">è«‹é»é¸ã€Œä¸‹ä¸€æ­¥ã€ä¾†åŸ·è¡Œ DFS æ¼”ç®—æ³•</div>

<div style="text-align:center;">
  <button onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
  <button onclick="reset()">é‡ç½®</button>
</div>

<script>
let steps = [], index = 0, maxSum = -Infinity;
let values = [1,2,3];

function highlightLine(n) {
  for (let i = 1; i <= 10; i++) {
    document.getElementById("c"+i).classList.remove("active-line");
  }
  if (n) document.getElementById("c"+n).classList.add("active-line");
}

function loadTree() {
  try {
    values = JSON.parse(document.getElementById("treeInput").value);
    buildTree();
    reset();
  } catch {
    alert("æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥é™£åˆ—æ ¼å¼");
  }
}

function buildTree() {
  const tree = document.getElementById("tree");
  tree.innerHTML = "";
  const levels = Math.floor(Math.log2(values.length)) + 1;
  let idx = 0;
  for (let i = 0; i < levels; i++) {
    const layer = document.createElement("div");
    layer.className = "layer";
    const count = Math.pow(2, i);
    for (let j = 0; j < count && idx < values.length; j++, idx++) {
      const val = values[idx];
      const div = document.createElement("div");
      div.className = "node";
      div.id = "n"+idx;
      div.innerHTML = (val !== null && val !== undefined ? val : "âˆ…") + `<div class="value-label" id="v${idx}"></div>`;
      layer.appendChild(div);
    }
    tree.appendChild(layer);
  }
}

function simulateDFS() {
  steps = [];
  function dfs(i) {
    if (i >= values.length || values[i] === null) return 0;
    steps.push({ type:"highlight", node:i }); highlightLine(4);
    const left = dfs(2*i+1); highlightLine(5);
    const right = dfs(2*i+2); highlightLine(6);
    const total = values[i] + left + right;
    steps.push({ type:"evaluate", node:i, left, right, total });
    if (total > maxSum) {
      maxSum = total;
      steps.push({ type:"updateMax", value:total });
    }
    const ret = values[i] + Math.max(left, right);
    steps.push({ type:"return", node:i, ret });
    return ret;
  }
  dfs(0); highlightLine(10);
}

function nextStep() {
  if (index >= steps.length) return;
  const step = steps[index++];
  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));

  if (step.type === "highlight") {
    document.getElementById("n"+step.node).classList.add("highlight");
    document.getElementById("info").innerText = `ğŸ” è¨ªå•ç¯€é» ${values[step.node]}`;
    highlightLine(4);
  } else if (step.type === "evaluate") {
    document.getElementById("v"+step.node).innerText = `L:${step.left}, R:${step.right}, ç¸½:${step.total}`;
    document.getElementById("info").innerText = `ğŸ“Š ç¸½å’Œ = ${step.total}`;
    highlightLine(7);
  } else if (step.type === "updateMax") {
    document.getElementById("maxSum").innerText = step.value;
    document.getElementById("info").innerText = `âœ… æ›´æ–°æœ€å¤§ç¸½å’Œï¼š${step.value}`;
    highlightLine(8);
  } else if (step.type === "return") {
    document.getElementById("info").innerText = `â†©ï¸ å›å‚³çµ¦çˆ¶ç¯€é»ï¼š${step.ret}`;
    highlightLine(9);
  }
}

function reset() {
  index = 0;
  maxSum = -Infinity;
  document.getElementById("maxSum").innerText = "-âˆ";
  document.getElementById("info").innerText = "è«‹é»é¸ã€Œä¸‹ä¸€æ­¥ã€ä¾†åŸ·è¡Œ DFS æ¼”ç®—æ³•";
  document.querySelectorAll(".value-label").forEach(v => v.innerText = "");
  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));
  simulateDFS();
}
buildTree();
simulateDFS();
</script>
</body>
</html>
