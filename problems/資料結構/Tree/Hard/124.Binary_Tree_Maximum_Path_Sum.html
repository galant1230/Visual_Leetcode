<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>124. æœ€å¤§è·¯å¾‘ç¸½å’Œå‹•ç•«æ¨¡æ“¬å™¨</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      margin: 0;
      color: #333;
    }
    h2, h3 {
      color: #007acc;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    input, button {
      font-size: 1rem;
      margin: 0.5rem 0.3rem;
      padding: 0.4rem 0.6rem;
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .tree {
      text-align: center;
      margin-top: 2rem;
    }
    .layer {
      display: flex;
      justify-content: center;
      margin: 2rem 0;
    }
    .node {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #3498db;
      background: white;
      color: #3498db;
      font-weight: bold;
      font-size: 20px;
      margin: 0 20px;
      position: relative;
    }
    .node.highlight { background: #f39c12; color: white; }
    .value-label {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
    }
    .info {
      margin-top: 1rem;
      padding: 1rem;
      background: #ecf0f1;
      border-left: 6px solid #3498db;
      white-space: pre-wrap;
    }
    #logBox {
      margin-top: 1rem;
      background: #f4f6f8;
      padding: 1rem;
      border-radius: 6px;
      font-size: 14px;
      max-height: 200px;
      overflow-y: auto;
    }
    #maxSumBox {
      background: #e1f5fe;
      border: 2px solid #29b6f6;
      padding: 1rem;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin-top: 2rem;
      color: #007acc;
    }
    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
    .active-line {
      background: #444;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>ğŸŒ² 124. äºŒå…ƒæ¨¹ä¸­çš„æœ€å¤§è·¯å¾‘ç¸½å’Œ</h2>

  <hr>
  <h3>ğŸ“˜ é¡Œç›®æè¿°</h3>
  <p>çµ¦å®šä¸€æ£µäºŒå…ƒæ¨¹ï¼Œæ‰¾å‡ºä»»æ„è·¯å¾‘ä¸­ç¸½å’Œæœ€å¤§çš„å€¼ï¼ˆè·¯å¾‘å¯ä»¥å¾ä»»ä½•ç¯€é»åˆ°ä»»ä½•ç¯€é»ï¼Œä½†ä¸èƒ½å›é ­ï¼‰ã€‚</p>

  <hr>
  <h3>ğŸ§  è§£æ³•èªªæ˜</h3>
  <ul>
    <li>ä½¿ç”¨ DFS éæ­·ç¯€é»</li>
    <li>å°æ¯å€‹ç¯€é»ï¼šè¨ˆç®—å¾å·¦å³å­æ¨¹ä¾†çš„æœ€å¤§è²¢ç»å€¼</li>
    <li>è¨ˆç®—ç¶“éç•¶å‰ç¯€é»çš„æœ€å¤§ç¸½å’Œï¼ˆå·¦å³ + æœ¬èº«ï¼‰</li>
    <li>æŒçºŒæ›´æ–°å…¨åŸŸæœ€å¤§å€¼</li>
  </ul>

  <hr>
  <h3>â³ æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦</h3>
  <ul>
    <li><strong>æ™‚é–“è¤‡é›œåº¦ï¼š</strong>O(n)</li>
    <li><strong>ç©ºé–“è¤‡é›œåº¦ï¼š</strong>O(h)ï¼Œh ç‚ºæ¨¹é«˜</li>
  </ul>

  <hr>
  <h3>â–¶ï¸ æ¨¡æ“¬å™¨</h3>
  <div>
    <label>è‡ªè¨‚æ¨¹ï¼ˆå¦‚ <code>[1,2,3,null,null,4,5]</code>ï¼‰ï¼š</label><br>
    <input id="treeInput" value="[1,2,3]" style="width:300px;" />
    <button onclick="loadTree()">è¼‰å…¥æ¨¹</button>
    <button onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
    <button onclick="reset()">é‡ç½®</button>
  </div>

  <div class="tree" id="tree"></div>
  <div id="maxSumBox">ğŸ”µ æœ€å¤§ç¸½å’Œï¼š<span id="maxSum">-âˆ</span></div>
  <div class="info">åŸ·è¡Œè¨˜éŒ„</div>
  <div id="logBox"></div>

  <hr>
  <h3>ğŸ’» ç¨‹å¼ç¢¼</h3>
  <pre id="codeBox">
<span id="c1">1: def maxPathSum(root):</span>
<span id="c2">2: &nbsp;&nbsp;&nbsp;&nbsp;maxSum = -âˆ</span>
<span id="c3">3: &nbsp;&nbsp;&nbsp;&nbsp;def dfs(node):</span>
<span id="c4">4: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not node: return 0</span>
<span id="c5">5: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left = max(dfs(node.left), 0)</span>
<span id="c6">6: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right = max(dfs(node.right), 0)</span>
<span id="c7">7: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current = node.val + left + right</span>
<span id="c8">8: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxSum = max(maxSum, current)</span>
<span id="c9">9: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return node.val + max(left, right)</span>
<span id="c10">10: return dfs(root)</span>
  </pre>
</div>

<script>
let steps = [], index = 0, maxSum = -Infinity;
let values = [1,2,3];

function highlightLine(n) {
  for (let i = 1; i <= 10; i++) {
    document.getElementById("c"+i).classList.remove("active-line");
  }
  if (n) document.getElementById("c"+n).classList.add("active-line");
}

function log(msg) {
  const logBox = document.getElementById("logBox");
  logBox.innerText += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

function loadTree() {
  try {
    values = JSON.parse(document.getElementById("treeInput").value);
    buildTree();
    reset();
  } catch {
    alert("æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥é™£åˆ—æ ¼å¼");
  }
}

function buildTree() {
  const tree = document.getElementById("tree");
  tree.innerHTML = "";
  const levels = Math.floor(Math.log2(values.length)) + 1;
  let idx = 0;
  for (let i = 0; i < levels; i++) {
    const layer = document.createElement("div");
    layer.className = "layer";
    const count = Math.pow(2, i);
    for (let j = 0; j < count && idx < values.length; j++, idx++) {
      const val = values[idx];
      const div = document.createElement("div");
      div.className = "node";
      div.id = "n"+idx;
      div.innerHTML = (val !== null && val !== undefined ? val : "âˆ…") + `<div class="value-label" id="v${idx}"></div>`;
      layer.appendChild(div);
    }
    tree.appendChild(layer);
  }
}

function simulateDFS() {
  steps = [];
  function dfs(i) {
    if (i >= values.length || values[i] === null) return 0;
    steps.push({ type:"highlight", node:i }); highlightLine(4);
    const left = dfs(2*i+1); highlightLine(5);
    const right = dfs(2*i+2); highlightLine(6);
    const total = values[i] + left + right;
    steps.push({ type:"evaluate", node:i, left, right, total });
    if (total > maxSum) {
      maxSum = total;
      steps.push({ type:"updateMax", value:total });
    }
    const ret = values[i] + Math.max(left, right);
    steps.push({ type:"return", node:i, ret });
    return ret;
  }
  dfs(0); highlightLine(10);
}

function nextStep() {
  if (index >= steps.length) return;
  const step = steps[index++];
  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));

  if (step.type === "highlight") {
    document.getElementById("n"+step.node).classList.add("highlight");
    log(`ğŸ” è¨ªå•ç¯€é» ${values[step.node]}`);
    highlightLine(4);
  } else if (step.type === "evaluate") {
    document.getElementById("v"+step.node).innerText = `L:${step.left}, R:${step.right}, ç¸½:${step.total}`;
    log(`ğŸ“Š ç¸½å’Œ = ${step.total}`);
    highlightLine(7);
  } else if (step.type === "updateMax") {
    document.getElementById("maxSum").innerText = step.value;
    log(`âœ… æ›´æ–°æœ€å¤§ç¸½å’Œï¼š${step.value}`);
    highlightLine(8);
  } else if (step.type === "return") {
    log(`â†©ï¸ å›å‚³çµ¦çˆ¶ç¯€é»ï¼š${step.ret}`);
    highlightLine(9);
  }
}

function reset() {
  index = 0;
  maxSum = -Infinity;
  document.getElementById("maxSum").innerText = "-âˆ";
  document.getElementById("logBox").innerText = "";
  document.querySelectorAll(".value-label").forEach(v => v.innerText = "");
  document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight"));
  simulateDFS();
}

buildTree();
simulateDFS();
</script>
</body>
</html>
